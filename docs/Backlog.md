# StockWise 项目待办清单 (Backlog)

> **小步快跑** —— 将大愿景拆解为可落地的任务。

---

## 🔥 当前最高优先级 (Sprint 7: 用户系统与按需数据同步)
*目标：实现用户级股票池管理、隐式/显式注册机制、按需数据同步。*

### 1. 数据库设计 (Database Schema)
- [x] **创建 `users` 表**：支持隐式和显式注册
- [x] **创建 `user_watchlist` 表**：用户级关注列表 (多对多关系)
- [x] **创建 `global_stock_pool` 表**：聚合所有用户关注的股票
- [x] **迁移现有 `stock_pool` 数据**：平滑过渡到新架构

### 2. 用户注册机制 (User Registration)
- [x] **前端 UUID 生成**：首次访问时自动生成并存储到 localStorage
- [x] **隐式注册 API**：自动创建匿名用户记录
- [x] **显式注册 UI**：用户名输入页面 (MVP 阶段仅用户名)
- [x] **用户升级逻辑**：匿名用户转为注册用户

### 3. 股票池管理 (Watchlist Management)
- [x] **用户级添加股票**：关联到 `user_watchlist` 表
- [x] **全局股票池更新**：自动维护 `watchers_count` 计数器
- [x] **用户级删除股票**：同步更新全局计数
- [x] **前端迁移**：从 localStorage 迁移到数据库 API

### 4. ETL 按需同步 (On-Demand Sync)
- [x] **修改 Python ETL**：从 `global_stock_pool` 读取同步列表
- [x] **优化同步逻辑**：仅同步有人关注的股票
- [x] **测试验证**：确保多用户场景下数据一致性

---

## ✅ 已完成 (Sprint 6: AI 决策闭环)
*目标：实现 AI 预测、自动验证、胜率统计的完整链路。*

### 1. 数据库与数据结构 (Database)
- [x] **创建 `ai_predictions` 表**：已经在本地 SQLite 中同步。
- [ ] **迁移历史数据**：确保原有的 `daily_prices.ai_summary` 能够平滑过渡到新体系。

### 2. 后端数据管道 (Backend/ETL)
- [ ] **Gemini Prompt 结构化升级**：重写分析 Prompt，强制 AI 返回 JSON 格式（包含 `signal`, `confidence`, `support_price`）。
- [x] **自动验证引擎实现**：
    - 读取昨日预测。
    - 对比今日实际开盘/最高/收盘价。
    - 计算结果（Correct/Incorrect）并回填数据库。
- [x] **增量同步优化**：确保验证逻辑在每日同步任务中自动触发。

### 3. 前端界面与交互 (Frontend/UX)
- [x] **Dashboard 增强**：
    - 显示 AI 的置信度（Confidence）。
    - 增加基于 AI 建议的 "入场/离场" 参考位展示。
- [x] **History 页面重构**：
    - 展示 "昨日 AI 表现" 的浮窗或卡片。
    - 将验证结果可视化（用 ✅/❌ 代替枯燥的文字）。
- [x] **统计看板 (Analytics)**：
    - 实时计算并展示 "整体胜率"。
    - 展示 "平均盈亏比" 统计数字。

---

## 🏃 迭代计划 (Next Sprints)

### Sprint: 核心股票池优化
- [ ] 筛选 50 只高流动性标的列表。
- [ ] 优化 ETL 效率，支持批处理同步。

### Sprint: 用户体验进阶
- [ ] PWA 离线访问支持。
- [ ] 多策略对比：支持对比不同的 AI 分析模型。

---

## 📅 长期愿景 (Icebox)
- [ ] 接入更多维度数据 (新闻舆情、龙虎榜数据)。
- [ ] 实现全站/单股的胜率排行。
- [ ] 支持用户自定义 AI 角色（如：激进型、稳健型风控官）。

---

## 📝 开发指南
1. **先验证，后预测**：ETL 运行时，必须先判定昨日预测的死活，再生成今日的新建议。
2. **数据为王**：所有 AI 的文字分析都必须有对应的数值支撑。
3. **零容忍幻觉**：如果指标缺失，AI 必须返回 "Side/观望" 信号。
