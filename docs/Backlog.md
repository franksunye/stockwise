# StockWise 项目待办清单 (Backlog)

> **小步快跑** —— 将大愿景拆解为可落地的任务。

---

## 🔥 当前最高优先级 (Sprint 8: 系统稳定性与数据质量)

### 1. 新股数据质量检查 (P0)
- [ ] **数据完整性验证**：在 `process_stock_period()` 中添加数据行数检查
- [ ] **跳过 AI 预测逻辑**：数据不足 30 天时仅存储价格数据，不生成 AI 预测
- [ ] **前端标识**：在 UI 中标注"数据不足"的股票

### 2. 任务超时保护 (P1)
- [ ] **GitHub Actions 超时配置**：为 `daily_sync.yml` 添加 `timeout-minutes: 45`
- [ ] **AI 调用超时控制**：为 AI 预测添加 30 秒超时 + 降级策略
- [ ] **数据库写入重试**：添加 exponential backoff 重试机制

### 3. 错误处理增强 (P2)
- [ ] **结构化错误日志**：改进错误详情记录（不截断为 100 字符）
- [ ] **错误类型分类**：区分数据源错误、计算错误、网络错误
- [ ] **详细错误报告**：企业微信通知包含错误类型和时间戳

### 4. 多周期同步依赖优化 (P2)
- [ ] **依赖关系检查**：日线失败时跳过周线/月线
- [ ] **返回值标准化**：`process_stock_period()` 返回 success/failure 状态
- [ ] **事务一致性**：确保多周期数据的原子性

---

## 🏃 迭代计划 (Next Sprints)

### Sprint: 数据质量监控 (P3)
- [ ] **创建 `data_quality_metrics` 表**：记录每次同步的数据完整性指标
- [ ] **AI 预测准确率追踪**：按时间维度统计胜率趋势
- [ ] **数据源可用性监控**：记录 AkShare API 的成功率
- [ ] **质量报告仪表板**：可视化数据质量指标

### Sprint: 停牌/退市股票管理 (P3)
- [ ] **添加股票状态字段**：`status: active/suspended/delisted`
- [ ] **自动状态检测**：连续 N 天无数据更新 → 标记为 suspended
- [ ] **ETL 跳过逻辑**：不同步非活跃股票
- [ ] **定期清理任务**：移除长期退市的股票

### Sprint: 核心股票池优化
- [ ] 筛选 50 只高流动性标的列表
- [ ] 优化 ETL 效率，支持批处理同步

### Sprint: 用户体验进阶
- [ ] PWA 离线访问支持
- [ ] 多策略对比：支持对比不同的 AI 分析模型

---

## 📅 长期愿景 (Icebox)
- [ ] 接入更多维度数据 (新闻舆情、龙虎榜数据)
- [ ] 实现全站/单股的胜率排行
- [ ] 支持用户自定义 AI 角色（如：激进型、稳健型风控官）
- [ ] 多市场支持（美股、加密货币）
- [ ] 社区功能（用户分享、评论）

---

## ✅ 最近完成 (2025-12-26)

### 系统稳定性改进
- [x] **修复新股 MACD 计算错误**：指标计算失败时填充 0 值
- [x] **修复 JSON 序列化错误**：numpy int64 类型转换
- [x] **统一 Python 版本**：所有 GitHub Actions 使用 Python 3.11
- [x] **添加 pip 缓存**：加速 CI/CD 构建
- [x] **实时同步并发控制**：防止任务重叠运行
- [x] **On-Demand Sync 通知**：成功/失败都发送企业微信通知

### 文档更新
- [x] **架构文档重构**：创建 `Architecture.md`，移除旧的 `Architecture_Sprint7.md`
- [x] **潜在隐患分析**：完整记录后台任务的风险点和改进计划

---

## 📝 开发指南
1. **先验证，后预测**：ETL 运行时，必须先判定昨日预测的死活，再生成今日的新建议。
2. **数据为王**：所有 AI 的文字分析都必须有对应的数值支撑。
3. **零容忍幻觉**：如果指标缺失，AI 必须返回 "Side/观望" 信号。
4. **边界情况优先**：新股、停牌、退市等边界情况需要特殊处理。
5. **失败即通知**：所有后台任务失败都应发送通知，不能静默失败。

---

**最后更新**: 2025-12-26
