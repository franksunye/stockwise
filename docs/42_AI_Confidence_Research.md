# AI 置信度校准与观望阈值研究报告

## 1. 背景与目标

在构建 StockWise 的 AI 预测系统时，我们面临一个核心决策难题：**如何定义“观望” (Side/Hold) 的阈值？**

当前系统采用 LLM (Large Language Model) 输出 `Long/Short/Side` 信号及置信度 (`confidence`)。为了提高预测的实战价值，我们需要明确何时应该拒绝做出方向性判断，即“拒识”（Rejection）。

本分析旨在对比金融量化行业的传统最佳实践与 LLM 的特性，制定适合 StockWise 的置信度校准方案。

---

## 2. 行业最佳实践 (Traditional Quant & ML)

在传统算法交易和机器学习领域，处理“不确定性”有一套成熟的标准做法。

### 2.1 三段式阈值模型 (3-Class Thresholding)

量化模型（如 XGBoost, LSTM）输出的是严格的**统计概率 (Statistical Probability)**。行业通常不会使用默认的 0.5 作为分类界限，而是采用“三段式”划分：

*   **Long Zone (做多区)**: $P(Up) > T_{high}$ (通常为 0.70 ~ 0.80)
*   **Neutral Zone (观望区)**: $T_{low} \leq P(Up) \leq T_{high}$
*   **Short Zone (做空区)**: $P(Up) < T_{low}$ (通常为 0.20 ~ 0.30)

**核心逻辑**：
*   **胜率门槛**：由于交易存在成本（手续费、滑点、资金占用），仅仅 51% 的预测上涨概率不足以产生期望收益（Expected Value）。
*   **噪声过滤**：金融数据信噪比极低，大部分时间的波动属于随机游走（Random Walk）。宽泛的观望区是过滤噪声的刚需。

### 2.2 评估指标

*   **Precision (查准率)**：我预测做多时，到底有多少次是对的？（我们**最关注**的指标）
*   **Recall (查全率)**：所有真正上涨的机会，我抓住了多少？

**权衡**：在提高阈值时，Recall 会下降（即使错过一些机会），但 Precision 会上升。对于个人投资者辅助工具，**高 Precision（宁缺毋滥）远比高 Recall 重要**。

---

## 3. LLM 的特殊性：自信的陷阱

直接将量化行业的数值标准套用到 LLM 上是危险的，因为两者的“置信度”本质不同。

### 3.1 语义置信度 vs. 统计概率

*   **量化模型**：输出的 0.65 意味着“在历史回测中，类似模式有 65% 的概率上涨”。这是**客观的数学统计**。
*   **LLM**：输出的 0.65 往往意味着“我对这句话的通顺程度、逻辑自洽度有 65% 的信心”，或者是模型在预训练时见过的类似文本的概率。这是**主观的语义自信**。

### 3.2 校准误差 (Miscalibration) 与幻觉

研究表明，LLM 普遍存在**过度自信 (Overconfidence)** 问题：
*   **Breezy Confidence**：LLM 倾向于用非常确定的语气（0.9+）陈述错误的事实或逻辑。
*   **极化倾向**：未经微调的 LLM 不喜欢输出 “0.5” 或 “不知道”，它们更喜欢在 A 和 B 之间选一个，甚至编造理由。

**结论**：在 LLM 语境下，**0.6 的置信度几乎等同于“瞎猜”**，而 0.8 可能只相当于传统量化的 0.6。我们需要为 LLM 的置信度打折，或设置更高的门槛。

---

## 4. 差异对比与策略制定

| 维度           | 传统量化 (Quant/ML) | StockWise (LLM-based) | 我们的对策                                                              |
| :------------- | :------------------ | :-------------------- | :---------------------------------------------------------------------- |
| **置信度含义** | 历史统计胜率        | 语义逻辑/文本概率     | **提高阈值**：将开仓门槛从行业的 0.7 提升至 **0.8+** 以抵消“虚高水分”。 |
| **观望判定**   | 落在中间区间的概率  | 需要 Prompt "诱导"    | **Prompt 锚点**：明确告诉 AI "默认观望"，除非证据确凿。                 |
| **风控机制**   | 凯利公式仓位控制    | 幻觉抑制              | **强熔断机制**：只要分数不够，强制覆盖为 Side。                         |

### 4.1 StockWise 的升级策略

基于上述分析，我们对 Prompt 和系统的升级方向如下：

#### A. Prompt 层面：重塑锚点 (Re-anchoring)
**旧逻辑 (Current)**：
> "如果信号是 Side，置信度不应超过 0.6。"
> *问题：这是后置约束，诱导 AI 为了给低分而选 Side，逻辑反了。*

**新逻辑 (Proposed)**：
> "核心原则：宁缺毋滥 (Better safe than sorry)。默认情况下请保持 'Side'。只有当你发现胜率超过 **80%** 的极佳机会时，才允许输出 Long/Short。"
> *优势：前置准入，符合 Risk-First 原则。*

#### B. 系统层面：置信度熔断 (Confidence Circuit Breaker)
在后端代码中实施“硬规则”裁决，不再完全信任 LLM 的判断：

```python
# 伪代码：置信度熔断机制
AI_CONFIDENCE_THRESHOLD = 0.75  # 只有超过 75% 把握才允许开仓

if prediction.signal != 'Side':
    if prediction.confidence < AI_CONFIDENCE_THRESHOLD:
        # 强制修正
        prediction.signal = 'Side'
        prediction.reasoning += " [系统注: 虽看多但置信度不足，强制观望]"
```

## 5. 总结

StockWise 不应追求传统量化的“高频交易”模式，而应定位为**“精品投资顾问”**。

*   **行业标准**是 0.6~0.7 开始看多。
*   **LLM 特性**要求我们必须溢价处理，将阈值定在 **0.8**。
*   **"观望"不是失败**，而是系统帮助用户规避不确定性风险的主动防御。

通过实施这套**“基于高语义置信度的拒识机制”**，我们可以有效压制 LLM 的幻觉，提供真正具备实战参考价值的建议。
