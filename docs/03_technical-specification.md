# 03. æŠ€æœ¯è§„æ ¼

> **å‰åç«¯å¼€å‘è“å›¾** â€”â€” Serverless æ¶æ„ï¼Œé›¶ç»´æŠ¤æˆæœ¬

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### MVP é˜¶æ®µç­–ç•¥ (0-100 ç”¨æˆ·)

- **ç”¨æˆ·ç³»ç»Ÿ**: âŒ æ— éœ€ç™»å½•/æ³¨å†Œ
- **Watchlist**: å­˜å‚¨åœ¨æµè§ˆå™¨ `localStorage`
- **æ•°æ®æ›´æ–°**: åå°å…¨é‡æ›´æ–° **50 åªæ ¸å¿ƒè‚¡ç¥¨**
- **æ‰©å±•è·¯å¾„**: 100+ ç”¨æˆ·åè¿ç§»åˆ°äº‘ç«¯ Watchlist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¾å¤‡                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Next.js PWA (Vercel)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚Dashboard â”‚  â”‚ Settings â”‚  â”‚ History  â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚       â”‚              â”‚              â”‚               â”‚   â”‚
â”‚  â”‚       â–¼              â–¼              â”‚               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ Turso   â”‚   â”‚LocalStorageâ”‚       â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ (è¯»å–)  â”‚   â”‚ (Watchlist)â”‚       â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ç®¡é“ (æ¯æ—¥ 18:00)                     â”‚
â”‚                                                              â”‚
â”‚  GitHub Actions â†’ Python â†’ Akshare â†’ Pandas TA â†’ Turso     â”‚
â”‚  (ä»…æ›´æ–° 50 åªæ ¸å¿ƒè‚¡ç¥¨)        â†“                            â”‚
â”‚                           Gemini                             â”‚
â”‚                         (AI ç‚¹è¯„)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ–¥ï¸ å‰ç«¯ (Next.js)

### æŠ€æœ¯æ ˆ

| ç±»åˆ« | é€‰å‹ |
|------|------|
| æ¡†æ¶ | Next.js 14+ (App Router) |
| è¯­è¨€ | TypeScript |
| æ ·å¼ | Tailwind CSS |
| å›¾æ ‡ | Lucide React |
| æœåŠ¡ç«¯ | React Server Components â†’ Turso |
| æœ¬åœ°å­˜å‚¨ | localStorage |

### è®¾è®¡ç³»ç»Ÿ (Dark Mode)

| ç”¨é€” | Tailwind Class |
|------|----------------|
| å…¨å±€èƒŒæ™¯ | `bg-slate-950` |
| å¡ç‰‡èƒŒæ™¯ | `bg-slate-900` |
| ä¸»è¦æ–‡å­— | `text-slate-50` |
| æ¬¡è¦æ–‡å­— | `text-slate-400` |
| çœ‹å¤š/ç›ˆåˆ© | `text-emerald-500` ğŸŸ¢ |
| æ­¢æŸ/äºæŸ | `text-rose-500` ğŸ”´ |
| è§‚æœ›/éœ‡è¡ | `text-amber-400` ğŸŸ¡ |

### å­—ä½“

- **æ•°å­—**ï¼šç­‰å®½å­—ä½“ (`Geist Mono`)
- **ä¸­æ–‡**ï¼šç³»ç»Ÿé»˜è®¤ (`PingFang SC` / `Microsoft YaHei`)

### é¡µé¢è·¯ç”±

| è·¯å¾„ | é¡µé¢ | è¯´æ˜ |
|------|------|------|
| `/` | Dashboard | å†³ç­–çœ‹æ¿ (Server Component) |
| `/history` | History | å¤ç›˜æ—¶é—´è½´ |
| Modal | Settings | é£æ§è§„åˆ™è®¾ç½® |

### å¼€å‘æ¸…å•

| # | ä»»åŠ¡ |
|---|------|
| 1 | Next.js åˆå§‹åŒ– + Tailwind + Turso è¿æ¥ |
| 2 | ç»„ä»¶å¼€å‘ï¼š`StockCard`, `SignalBadge` |
| 3 | Dashboardï¼šTurso æ•°æ® + LocalStorage è§„åˆ™å¯¹æ¯” |
| 4 | Settings Modalï¼šè§„åˆ™å½•å…¥ |
| 5 | Historyï¼šæ—¶é—´è½´ + é¿é™©æ”¶ç›Šè®¡ç®— |
| 6 | PWAï¼š`manifest.json` |

---

## âš™ï¸ åç«¯ (Python ETL)

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | é€‰å‹ |
|------|------|
| è°ƒåº¦å™¨ | GitHub Actions |
| æ•°æ®æº | Akshare (A è‚¡/æ¸¯è‚¡) |
| è®¡ç®—å¼•æ“ | Pandas TA |
| æ•°æ®åº“ | Turso (libSQL) |
| AI | Google Gemini |

### ä¾èµ–

```text
akshare
pandas
pandas_ta
libsql-experimental
google-generativeai
```

### ETL æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Akshare   â”‚ -> â”‚  Pandas TA â”‚ -> â”‚   Gemini   â”‚ -> â”‚   Turso    â”‚
â”‚  æ•°æ®æŠ“å–  â”‚    â”‚  æŒ‡æ ‡è®¡ç®—  â”‚    â”‚  AI ç‚¹è¯„   â”‚    â”‚  Upsert    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰§è¡Œæ—¶é—´**ï¼šæ¯æ—¥ UTC 10:00 (åŒ—äº¬ 18:00)

### æ ¸å¿ƒä»£ç ç»“æ„

```python
def process_stock(symbol: str):
    # 1. è·å–æ•°æ®
    df = ak.stock_hk_daily(symbol=symbol)
    
    # 2. è®¡ç®—æŒ‡æ ‡
    df.ta.sma(length=20, append=True)
    df.ta.rsi(length=14, append=True)
    
    # 3. AI ç‚¹è¯„
    summary = gemini.generate(prompt)
    
    # 4. å…¥åº“
    cursor.execute("INSERT OR REPLACE INTO daily_prices ...")
```

### GitHub Actions é…ç½®

**æ–‡ä»¶**ï¼š`.github/workflows/daily_sync.yml`

**Secrets**

| Key | ç”¨é€” |
|-----|------|
| `TURSO_DB_URL` | æ•°æ®åº“è¿æ¥ |
| `TURSO_AUTH_TOKEN` | è®¤è¯ Token |
| `GEMINI_API_KEY` | AI ç‚¹è¯„ |

### å¼€å‘è®¡åˆ’

| Phase | ç›®æ ‡ | å¤©æ•° |
|-------|------|------|
| 1 | æœ¬åœ° Python è·‘é€š + Turso å†™å…¥ | Day 1 |
| 2 | AI ç‚¹è¯„é›†æˆ | Day 2 |
| 3 | GitHub Actions éƒ¨ç½² | Day 3 |
| 4 | å‰åç«¯è”è°ƒ | Day 4 |

---

## ğŸ”Œ API æ¥å£

### å›¾ç‰‡åˆ†æ

**Endpoint**ï¼š`POST /api/analyze`

**Request**
```json
{
  "image": "base64...",
  "user_rules": "æ”¯æ’‘ä½ 14.78"
}
```

**Response**
```json
{
  "trend": "Bearish",
  "advice": "è·Œç ´æ”¯æ’‘ä½ï¼Œå»ºè®®æ­¢æŸã€‚"
}
```

---

## âš ï¸ å¼‚å¸¸å¤„ç†

| åœºæ™¯ | å¯¹ç­– |
|------|------|
| Akshare æ¥å£å¤±æ•ˆ | try-catch + å¤‡ç”¨æ¥å£ |
| LLM è¶…æ—¶/å¹»è§‰ | å¡«å…¥é»˜è®¤å€¼ï¼Œ**ä¸é˜»å¡å…¥åº“** |
| ä¼‘å¸‚æ—¥ | æ£€æµ‹äº¤æ˜“æ—¥ï¼Œå¦åˆ™ `exit(0)` |
| å‰ç«¯æ— æ•°æ® | æ˜¾ç¤ºæœ€è¿‘äº¤æ˜“æ—¥ |

---

*â†’ ä¸‹ä¸€ç¯‡ï¼š[04. æ•°æ®å­—å…¸](./04_data-dictionary.md)*
