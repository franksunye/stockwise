# StockWise 会员体系与商业化方案设计

> **核心思路**：通过“规则引擎 (免费)”与“LLM 深度分析 (付费)”的差异化，平衡服务成本与用户价值。

---

## 💎 1. 订阅方案矩阵 (Tier Matrix)

| 维度           | 免费版 (Free)           | 专业版 (Pro)         | 旗舰版 (Premium)     |
| :------------- | :---------------------- | :------------------- | :------------------- |
| **自选股容量** | 3 只                    | 10 只                | 100 只               |
| **分析引擎**   | **规则引擎** (静态指标) | **AI 引擎** (Gemini) | **AI 引擎** (Gemini) |
| **更新频率**   | 每 30 分钟同步          | 每 10 分钟同步       | 每 5 分钟同步        |
| **内容深度**   | 仅信号 (看多/空/观望)   | 信号 + 推理链 + 建议 | 信号 + 推理链 + 建议 |
| **通知提醒**   | 无                      | 企业微信关键信号推送 | 全方位实时监控提醒   |
| **历史复盘**   | 7 天记录                | 30 天记录            | 永久记录             |
| **价格**       | ¥0                      | ¥29/月               | ¥99/月               |

---

## 🛠️ 2. 技术架构调整

### A. 数据库层 (Turso/SQLite)
- **`users` 表增强**：
    - `subscription_tier`: 订阅等级 (`free`, `pro`, `premium`)
    - `subscription_expires_at`: 会员有效期
    - `last_active_at`: 最后活跃时间（用于清理过期监控池）
- **`user_watchlist` 表增强**：
    - `analysis_mode`: `rule` 或 `ai`（由订阅等级决定）

### B. ETL 调度层 (Python)
- **按需分析**：
    1. ETL 过程中，统计该股票的所有订阅用户。
    2. 如果该股票的订阅者中包含至少一名 `pro/premium` 用户，则触发 **LLM 分析流程**。
    3. 如果全是 `free` 用户，则仅运行 **规则引擎**（通过 Pandas 技术指标计算简单信号）。
- **资源浪费避免**：
    - 对于 30 天未登录的免费用户，其监控池停止自动更新。

### C. 分析引擎分流
- **Rule Engine (免费)**：
    - 基于 RSI > 70 卖出、MACD 金叉买入等硬规则生成信号。
    - **成本**：$0。
- **AI Engine (付费)**：
    - 调用 Gemini 2.0 Flash/Pro，注入最近 14 天行情数据。
    - 生成结构化推理链和具体的战术动作。
    - **成本**：按 Token 计费。

---

## 📱 3. 用户体验 (UX) 设计

### A. 个人中心 (Profile Center)
- **身份标识**：展示会员徽章（Pro/Premium）。
- **配额管理**：实时查看自选股使用量（如 2/3）。
- **付费入口**：集成微信支付/支付宝 H5 支付。

### B. Dashboard 差异化控制
- **锁定状态**：免费用户在查看 AI 推理部分时，显示毛玻璃效果并提示“升级 Pro 解锁 AI 深度洞察”。
- **信号区分**：
    - 规则引擎生成的信号标注 `[Rule]`。
    - AI 推理生成的信号标注 `[AI]`。

---

## 📈 4. 实施阶段 (Roadmap)

### 第 0 阶段：邀请制内测验证 (Beta)
> **目标**：在不开发支付系统的前提下，快速验证“Pro 版”价值，并控制种子用户规模。
- [x] **数据库**：新增 `invitation_codes` 表 (code, type, is_used, created_at) 和 `users` 表扩展。
- [x] **后台**：编写简单的发码脚本 (CLI工具: `manage_codes.py`)，生成一批 Pro 激活码。
- [x] **前端**：个人中心增加“兑换激活码”入口，并实现本地 Watchlist 自动同步上云。
- [x] **逻辑**：实现差异化分析引擎，根据订阅状态动态分流 (AI vs Rule)。
- [ ] **运营**：向核心社群定向发放激活码，收集反馈。

### 第一阶段：地基搭建 (P0)
- [ ] 数据库 Schema 更新。
- [ ] ETL 代码支持“最高等级优先”分析逻辑（即：若有付费用户关注，则进行 AI 分析并缓存结果）。

### 第二阶段：前端分流 (P1)
- [ ] 实现“个人中心”基础页面。
- [ ] Dashboard 根据用户等级决定是否渲染 `TacticalBriefDrawer` 的深度内容。
- [ ] 按钮权限控制：超过 3 只股票时弹出升级弹窗。

### 第三阶段：商业化闭环 (P2)
- [ ] 过期用户数据清理脚本。
- [ ] 支付接口对接。
- [ ] 会员到期提醒功能。

---

## ⚠️ 资源管控逻辑
1. **监控池过期**：免费用户 14 天不活跃，移出 `global_stock_pool`，节省 ETL 资源。
2. **AI 配额**：Pro 用户每月设定 AI 分析上限（如 1000 次请求/月），防止 API 滥用。
