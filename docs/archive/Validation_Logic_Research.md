# StockWise 信号验证机制研究与设计文档

**文档状态**: 草案 (Draft)  
**创建日期**: 2026-01-03  
**作者**: Antigravity (AI Assistant)

## 1. 背景与问题

StockWise 目前采用 LLM (Large Language Module) 作为核心分析引擎，为个人投资者提供 `Long` (做多)、`Short` (避险/做空)、`Side` (观望) 三种操作建议。

### 当前的验证逻辑 (Legacy Logic)
系统通过 `validate_previous_prediction` 函数对 "T-1日" 的预测进行 "T日" 验证。目前的标准是**绝对二元验证 (Absolute Binary Validation)**：

*   **Long**: T日涨幅 > 0% 判定为 **Correct**，否则 **Incorrect**。
*   **Side**: T日涨幅 <= 0% 判定为 **Correct**，否则 **Incorrect**。

### 存在的问题
这种“非黑即白”的绝对标准在金融实践中显得过于苛刻且失真，主要体现在：
1.  **噪音惩罚 (Noise Penalty)**: 如果 AI 建议观望 (Side)，而当天市场微涨 0.05%（甚至不足以覆盖交易成本），当前逻辑会判定 AI **错误**。这实际上惩罚了正确的“不操作”决策。
2.  **忽略交易摩擦**: 0.01% 的微利在扣除印花税和佣金后实际为亏损，但当前逻辑判定为“正确”，可能误导模型优化方向。
3.  **LLM 角色定位偏差**: LLM 在本项目中更接近“投资顾问”而非“高频交易算法”。顾问的核心价值在于**大方向正确**和**风险控制**，而非精确捕捉每一个 0.01% 的波动。

---

## 2. 行业最佳实践调研 (Industry Best Practices)

在量化交易、信号处理及 AI 金融应用领域，主流的信号验证方法通常包含以下维度：

### A. 噪音阈值 (Noise Threshold / Deadband)
大多数趋势跟踪策略都会引入一个“无视区间”。
*   **理念**: 市场存在随机漫步特征。在波动率极低的日子里（如涨跌幅在 -0.5% ~ +0.5% 之间），方向并不重要，重要的是**没有发生重大风险**。
*   **应用**: “观望”信号在微涨微跌时都应被视为“验证成功”。

### B. 交易成本调整 (Transaction Cost Adjustment)
*   **理念**: 信号的盈利能力必须覆盖交易成本（各市场的印花税、佣金、滑点）。
*   **应用**: `Long` 信号不仅仅要求 `> 0`，通常要求 `> Cost_Threshold` (e.g., 0.2%) 才算有效命中。

### C. 评价指标的多样化
单纯的准确率 (Accuracy) 往往具有误导性。行业更关注：
*   **Precision vs. Recall**: 在发出 Long 信号时，有多大比例是真的大涨？
*   **PnL Impact (盈亏影响)**: 错过一次 10% 的大涨（False Negative on Side）比错过一次 0.5% 的微涨要严重得多。

### D. LLM 特有的“幻觉”与“逻辑”验证
对于 LLM，除了结果验证，还需要关注过程验证（Prompt Evaluation）。但在自动化回测层面，主要依然依赖结果数据。

---

## 3. 针对 StockWise 的改良方案

结合 LLM 的特性和个人投资者的需求，我们提出从“绝对正确”转向“模糊正确 (Fuzzy Correctness)”的演进路线。

### 核心理念
**“宁可错过微利，不可做错方向；观望也是一种成功的防御。”**

### 推荐方案：引入噪音容忍阈值 (Proposed Logic)

我们将引入 `NOISE_THRESHOLD` (建议值: 1.0% 或 0.5%) 来重新定义验证标准。

#### 新的真值表 (Truth Table)

| AI 信号   | 市场实际表现 ($A$) | 旧判定      | **新判定**      | 逻辑解释                                                                        |
| :-------- | :----------------- | :---------- | :-------------- | :------------------------------------------------------------------------------ |
| **Long**  | $A > 0$            | ✅ Correct   | ✅ **Correct**   | 只有赚钱才是硬道理                                                              |
| **Long**  | $A \le 0$          | ❌ Incorrect | ❌ **Incorrect** | 做多亏钱/平盘即为错                                                             |
| **Side**  | $A \le 0$          | ✅ Correct   | ✅ **Correct**   | 有效发出了避险/观望信号                                                         |
| **Side**  | $0 < A \le 1.0\%$  | ❌ Incorrect | ✅ **Correct**   | **核心变更点**。踏空了 <1% 的微利，但避免了操作成本和精力，属于“可接受的策略”。 |
| **Side**  | $A > 1.0\%$        | ❌ Incorrect | ❌ **Incorrect** | **核心变更点**。错过了 >1% 的显著行情，属于真正的“踏空/保守过度”。              |
| **Short** | $A < 0$            | ✅ Correct   | ✅ **Correct**   | 成功预警下跌                                                                    |

#### 方案优势
1.  **符合散户直觉**: 用户不会通过捕捉 0.2% 的波动致富，用户更在意的是“大跌我躲掉没？”和“大涨我抓到没？”。
2.  **提升“观望”的含金量**: 鼓励 AI 在这种震荡市大胆喊 Side，而不是被迫去猜那 0.1% 的涨跌。
3.  **数据更平滑**: 能减少因为 0.01% 的误差导致的验证状态来回跳动。

---

## 4. 后续实施建议

1.  **代码层**: 修改 `backend/engine/validator.py`，引入 `NOISE_THRESHOLD` 常量。
2.  **数据回溯**: 实施新逻辑后，建议运行 `backfill_validation` 脚本，刷新过去 30 天的验证状态，以获得更公正的历史胜率统计。
3.  **前端展示**: 前端的 "Correct/Incorrect" 可以保持文案不变，但其背后的统计口径将变得更加宽容和科学。未来可以考虑增加 "Partial Correct" (小赢) 的状态，但在现阶段保持二元展示更简洁。

## 5. 参考文献
- *Evaluation of LLMs in Financial Forecasting*
- *Quantitative Trading Strategies: Benchmarking and Validation*
