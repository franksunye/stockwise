# StockWise ä¼šå‘˜ä½“ç³»ä¸å•†ä¸šåŒ–æ–¹æ¡ˆè®¾è®¡

> **æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡â€œè§„åˆ™å¼•æ“ (å…è´¹)â€ä¸â€œLLM æ·±åº¦åˆ†æ (ä»˜è´¹)â€çš„å·®å¼‚åŒ–ï¼Œå¹³è¡¡æœåŠ¡æˆæœ¬ä¸ç”¨æˆ·ä»·å€¼ã€‚

---

## ğŸ’ 1. è®¢é˜…æ–¹æ¡ˆçŸ©é˜µ (Tier Matrix)

| ç»´åº¦           | å…è´¹ç‰ˆ (Free)           | ä¸“ä¸šç‰ˆ (Pro)         | æ——èˆ°ç‰ˆ (Premium)     |
| :------------- | :---------------------- | :------------------- | :------------------- |
| **è‡ªé€‰è‚¡å®¹é‡** | 3 åª                    | 10 åª                | 100 åª               |
| **åˆ†æå¼•æ“**   | **è§„åˆ™å¼•æ“** (é™æ€æŒ‡æ ‡) | **AI å¼•æ“** (Gemini) | **AI å¼•æ“** (Gemini) |
| **æ›´æ–°é¢‘ç‡**   | æ¯ 30 åˆ†é’ŸåŒæ­¥          | æ¯ 10 åˆ†é’ŸåŒæ­¥       | æ¯ 5 åˆ†é’ŸåŒæ­¥        |
| **å†…å®¹æ·±åº¦**   | ä»…ä¿¡å· (çœ‹å¤š/ç©º/è§‚æœ›)   | ä¿¡å· + æ¨ç†é“¾ + å»ºè®® | ä¿¡å· + æ¨ç†é“¾ + å»ºè®® |
| **é€šçŸ¥æé†’**   | æ—                       | ä¼ä¸šå¾®ä¿¡å…³é”®ä¿¡å·æ¨é€ | å…¨æ–¹ä½å®æ—¶ç›‘æ§æé†’   |
| **å†å²å¤ç›˜**   | 7 å¤©è®°å½•                | 30 å¤©è®°å½•            | æ°¸ä¹…è®°å½•             |
| **ä»·æ ¼**       | Â¥0                      | Â¥29/æœˆ               | Â¥99/æœˆ               |

---

## ğŸ› ï¸ 2. æŠ€æœ¯æ¶æ„è°ƒæ•´

### A. æ•°æ®åº“å±‚ (Turso/SQLite)
- **`users` è¡¨å¢å¼º**ï¼š
    - `subscription_tier`: è®¢é˜…ç­‰çº§ (`free`, `pro`, `premium`)
    - `subscription_expires_at`: ä¼šå‘˜æœ‰æ•ˆæœŸ
    - `last_active_at`: æœ€åæ´»è·ƒæ—¶é—´ï¼ˆç”¨äºæ¸…ç†è¿‡æœŸç›‘æ§æ± ï¼‰
- **`user_watchlist` è¡¨å¢å¼º**ï¼š
    - `analysis_mode`: `rule` æˆ– `ai`ï¼ˆç”±è®¢é˜…ç­‰çº§å†³å®šï¼‰

### B. ETL è°ƒåº¦å±‚ (Python)
- **æŒ‰éœ€åˆ†æ**ï¼š
    1. ETL è¿‡ç¨‹ä¸­ï¼Œç»Ÿè®¡è¯¥è‚¡ç¥¨çš„æ‰€æœ‰è®¢é˜…ç”¨æˆ·ã€‚
    2. å¦‚æœè¯¥è‚¡ç¥¨çš„è®¢é˜…è€…ä¸­åŒ…å«è‡³å°‘ä¸€å `pro/premium` ç”¨æˆ·ï¼Œåˆ™è§¦å‘ **LLM åˆ†ææµç¨‹**ã€‚
    3. å¦‚æœå…¨æ˜¯ `free` ç”¨æˆ·ï¼Œåˆ™ä»…è¿è¡Œ **è§„åˆ™å¼•æ“**ï¼ˆé€šè¿‡ Pandas æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ç®€å•ä¿¡å·ï¼‰ã€‚
- **èµ„æºæµªè´¹é¿å…**ï¼š
    - å¯¹äº 30 å¤©æœªç™»å½•çš„å…è´¹ç”¨æˆ·ï¼Œå…¶ç›‘æ§æ± åœæ­¢è‡ªåŠ¨æ›´æ–°ã€‚

### C. åˆ†æå¼•æ“åˆ†æµ
- **Rule Engine (å…è´¹)**ï¼š
    - åŸºäº RSI > 70 å–å‡ºã€MACD é‡‘å‰ä¹°å…¥ç­‰ç¡¬è§„åˆ™ç”Ÿæˆä¿¡å·ã€‚
    - **æˆæœ¬**ï¼š$0ã€‚
- **AI Engine (ä»˜è´¹)**ï¼š
    - è°ƒç”¨ Gemini 2.0 Flash/Proï¼Œæ³¨å…¥æœ€è¿‘ 14 å¤©è¡Œæƒ…æ•°æ®ã€‚
    - ç”Ÿæˆç»“æ„åŒ–æ¨ç†é“¾å’Œå…·ä½“çš„æˆ˜æœ¯åŠ¨ä½œã€‚
    - **æˆæœ¬**ï¼šæŒ‰ Token è®¡è´¹ã€‚

---

## ğŸ“± 3. ç”¨æˆ·ä½“éªŒ (UX) è®¾è®¡

### A. ä¸ªäººä¸­å¿ƒ (Profile Center)
- **èº«ä»½æ ‡è¯†**ï¼šå±•ç¤ºä¼šå‘˜å¾½ç« ï¼ˆPro/Premiumï¼‰ã€‚
- **é…é¢ç®¡ç†**ï¼šå®æ—¶æŸ¥çœ‹è‡ªé€‰è‚¡ä½¿ç”¨é‡ï¼ˆå¦‚ 2/3ï¼‰ã€‚
- **ä»˜è´¹å…¥å£**ï¼šé›†æˆå¾®ä¿¡æ”¯ä»˜/æ”¯ä»˜å® H5 æ”¯ä»˜ã€‚

### B. Dashboard å·®å¼‚åŒ–æ§åˆ¶
- **é”å®šçŠ¶æ€**ï¼šå…è´¹ç”¨æˆ·åœ¨æŸ¥çœ‹ AI æ¨ç†éƒ¨åˆ†æ—¶ï¼Œæ˜¾ç¤ºæ¯›ç»ç’ƒæ•ˆæœå¹¶æç¤ºâ€œå‡çº§ Pro è§£é” AI æ·±åº¦æ´å¯Ÿâ€ã€‚
- **ä¿¡å·åŒºåˆ†**ï¼š
    - è§„åˆ™å¼•æ“ç”Ÿæˆçš„ä¿¡å·æ ‡æ³¨ `[Rule]`ã€‚
    - AI æ¨ç†ç”Ÿæˆçš„ä¿¡å·æ ‡æ³¨ `[AI]`ã€‚

---

## ğŸ“ˆ 4. å®æ–½é˜¶æ®µ (Roadmap)

### ç¬¬ 0 é˜¶æ®µï¼šé‚€è¯·åˆ¶å†…æµ‹éªŒè¯ (Beta)
> **ç›®æ ‡**ï¼šåœ¨ä¸å¼€å‘æ”¯ä»˜ç³»ç»Ÿçš„å‰æä¸‹ï¼Œå¿«é€ŸéªŒè¯"Pro ç‰ˆ"ä»·å€¼ï¼Œå¹¶é€šè¿‡è£‚å˜æœºåˆ¶æ§åˆ¶ç§å­ç”¨æˆ·è§„æ¨¡ã€‚

#### 1. å‡†å…¥æœºåˆ¶ (Invite-Only)
- **æ¿€æ´»ç æ¨¡å¼**ï¼šé€šè¿‡ç®¡ç†å‘˜å‘æ”¾çš„ Pro æ¿€æ´»ç ç›´æ¥å…‘æ¢ï¼ˆå¦‚ `PRO-XXXXXX`ï¼‰ï¼Œèµ‹äºˆ 30 å¤© Pro æƒé™ã€‚
- **é‚€è¯·é“¾æ¥æ¨¡å¼**ï¼šæ”¯æŒ `https://stockwise.xxx/dashboard?invite=USER_ID` æ ¼å¼ã€‚
    - **è¢«é‚€è¯·äºº**ï¼šé€šè¿‡é“¾æ¥è¿›å…¥åï¼Œè‡ªåŠ¨è·å¾— Pro è¯•ç”¨ï¼ˆå¯é…ç½®å¤©æ•°ï¼Œé»˜è®¤ 7 å¤©ï¼‰ï¼Œ**æ— éœ€æ¿€æ´»ç **ã€‚
    - **é‚€è¯·äºº**ï¼šè¢«é‚€è¯·äººæˆåŠŸå…¥æ± åï¼Œé‚€è¯·äººçš„ Pro æ—¶é•¿è‡ªåŠ¨å»¶é•¿ï¼ˆå¯é…ç½®å¤©æ•°ï¼Œé»˜è®¤ 7 å¤©ï¼‰ã€‚
    - **é€»è¾‘å®ç°**ï¼šå‰ç«¯åœ¨ `layout.tsx` æ‹¦æˆª `invite` å‚æ•°ï¼Œåç«¯åœ¨ `api/user/profile` é¦–æ¬¡åˆ›å»ºç”¨æˆ·æ—¶è®°å½• `referred_by` å¹¶å‘æ”¾åŒå‘å¥–åŠ±ã€‚

#### 2. æ ¸å¿ƒä»»åŠ¡
- [x] **æ•°æ®åº“**ï¼šæ–°å¢ `invitation_codes` è¡¨å’Œ `users` è¡¨æ‰©å±• (`referred_by`)ã€‚
- [x] **åå°**ï¼šç¼–å†™å‘ç è„šæœ¬ (CLIå·¥å…·: `manage_codes.py`)ã€‚
- [x] **å‰ç«¯**ï¼šä¸ªäººä¸­å¿ƒå¢åŠ "é‚€è¯·å¥½å‹"å…¥å£ï¼Œæ”¯æŒä¸€é”®å¤åˆ¶å¸¦å‚æ•°çš„é‚€è¯·é“¾æ¥ã€‚
- [x] **é€»è¾‘**ï¼šå®ç° `invite` å‚æ•°çš„æŒä¹…åŒ–æ•è·ä¸åç«¯å…³è”ï¼Œè¢«é‚€è¯·äººå¯ç»•è¿‡é‚€è¯·å¢™ã€‚
- [ ] **è¿è¥**ï¼šå‘æ ¸å¿ƒç¤¾ç¾¤å®šå‘å‘æ”¾æ¿€æ´»ç ï¼Œæ”¶é›†åé¦ˆã€‚

### ç¬¬ä¸€é˜¶æ®µï¼šåœ°åŸºæ­å»º (P0)
- [ ] æ•°æ®åº“ Schema æ›´æ–°ã€‚
- [ ] ETL ä»£ç æ”¯æŒ"æœ€é«˜ç­‰çº§ä¼˜å…ˆ"åˆ†æé€»è¾‘ï¼ˆå³ï¼šè‹¥æœ‰ä»˜è´¹ç”¨æˆ·å…³æ³¨ï¼Œåˆ™è¿›è¡Œ AI åˆ†æå¹¶ç¼“å­˜ç»“æœï¼‰ã€‚

### ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯åˆ†æµ (P1)
- [ ] å®ç°"ä¸ªäººä¸­å¿ƒ"åŸºç¡€é¡µé¢ã€‚
- [ ] Dashboard æ ¹æ®ç”¨æˆ·ç­‰çº§å†³å®šæ˜¯å¦æ¸²æŸ“ `TacticalBriefDrawer` çš„æ·±åº¦å†…å®¹ã€‚
- [ ] æŒ‰é’®æƒé™æ§åˆ¶ï¼šè¶…è¿‡ 3 åªè‚¡ç¥¨æ—¶å¼¹å‡ºå‡çº§å¼¹çª—ã€‚

### ç¬¬ä¸‰é˜¶æ®µï¼šå•†ä¸šåŒ–é—­ç¯ (P2)
- [ ] è¿‡æœŸç”¨æˆ·æ•°æ®æ¸…ç†è„šæœ¬ã€‚
- [ ] æ”¯ä»˜æ¥å£å¯¹æ¥ã€‚
- [ ] ä¼šå‘˜åˆ°æœŸæé†’åŠŸèƒ½ã€‚

---

## ğŸ›ï¸ 5. è¿è¥å¼€å…³è®¾è®¡ (Marketing Switches)

> **ç›®æ ‡**ï¼šå°†æ¿€æ´»ç ã€é‚€è¯·å¥–åŠ±ç­‰è¥é”€æœºåˆ¶è®¾è®¡ä¸ºå¯é…ç½®çš„å…¨å±€å¼€å…³ï¼Œä¾¿äºåœ¨ä¸åŒè¿è¥é˜¶æ®µçµæ´»å¯åœã€‚

### A. å¼€å…³çŸ©é˜µ

| å¼€å…³ç»„åˆ     | `requireInvite` | `enableReferralReward` | `enableRedemption` | é€‚ç”¨åœºæ™¯                                  |
| ------------ | --------------- | ---------------------- | ------------------ | ----------------------------------------- |
| **å†…æµ‹æœŸ**   | âœ… å¼€å¯          | âœ… å¼€å¯                 | âœ… å¼€å¯             | ä¸¥æ ¼æ§åˆ¶ç§å­ç”¨æˆ·ï¼Œé‚€è¯·å¯ç»•è¿‡å¢™+åŒæ–¹è·å¥–åŠ± |
| **å…¬æµ‹æœŸ**   | âŒ å…³é—­          | âœ… å¼€å¯                 | âœ… å¼€å¯             | ä»»ä½•äººéƒ½èƒ½ç”¨å…è´¹ç‰ˆï¼Œé‚€è¯·å¯å‡çº§ Pro        |
| **æ­£å¼ç‰ˆ**   | âŒ å…³é—­          | âŒ å…³é—­                 | âŒ å…³é—­             | çº¯ç²¹é ä»˜è´¹è½¬åŒ–ï¼Œä¸æè£‚å˜                  |
| **é™æ—¶æ´»åŠ¨** | âŒ å…³é—­          | âœ… å¼€å¯ (åŠ å€å¤©æ•°)      | âœ… å¼€å¯             | çŸ­æœŸæ‹‰æ–°å†²åˆº                              |

### B. å¼€å…³å®šä¹‰

| å¼€å…³å                 | ç±»å‹    | è¯´æ˜                                                                                                     |
| ---------------------- | ------- | -------------------------------------------------------------------------------------------------------- |
| `requireInvite`        | Boolean | **é‚€è¯·å¢™å¼€å…³**ã€‚å¼€å¯æ—¶ï¼Œç”¨æˆ·å¿…é¡»æœ‰æ¿€æ´»ç æˆ–è¢«é‚€è¯·æ‰èƒ½è¿›å…¥ç³»ç»Ÿï¼›å…³é—­æ—¶ï¼Œæ‰€æœ‰äººå¯ç›´æ¥è¿›å…¥ï¼ˆé»˜è®¤å…è´¹ç”¨æˆ·ï¼‰ã€‚ |
| `enableReferralReward` | Boolean | **é‚€è¯·å¥–åŠ±å¼€å…³**ã€‚å¼€å¯æ—¶ï¼Œé‚€è¯·é“¾æ¥æœ‰æ•ˆï¼ŒåŒæ–¹å¯è·å¾— Pro è¯•ç”¨ï¼›å…³é—­æ—¶ï¼Œé‚€è¯·é“¾æ¥æ— æ•ˆã€‚                      |
| `enableRedemption`     | Boolean | **æ¿€æ´»ç å…‘æ¢å¼€å…³**ã€‚å¼€å¯æ—¶ï¼Œå…è®¸ç”¨æ¿€æ´»ç å…‘æ¢ Proï¼›å…³é—­æ—¶ï¼Œç¦ç”¨æ¿€æ´»ç åŠŸèƒ½ã€‚                               |
| `refereeDays`          | Number  | è¢«é‚€è¯·äººè·å¾—çš„ Pro è¯•ç”¨å¤©æ•°ï¼ˆé»˜è®¤ 7 å¤©ï¼‰ã€‚                                                               |
| `referrerDays`         | Number  | é‚€è¯·äººè·å¾—çš„ Pro å¥–åŠ±å¤©æ•°ï¼ˆé»˜è®¤ 7 å¤©ï¼‰ã€‚                                                                 |

### C. é…ç½®æ–‡ä»¶ä½ç½®

```
frontend/src/lib/membership-config.ts
```

### D. å„æ¨¡å—æ¶ˆè´¹å…³ç³»

| æ¨¡å—                   | æ¶ˆè´¹çš„å¼€å…³             | è¡Œä¸ºå˜åŒ–                                       |
| ---------------------- | ---------------------- | ---------------------------------------------- |
| `dashboard/layout.tsx` | `requireInvite`        | å…³é—­æ—¶ï¼šè·³è¿‡é‚€è¯·å¢™ï¼Œç›´æ¥è®©ç”¨æˆ·è¿›å…¥ï¼ˆå…è´¹ç”¨æˆ·ï¼‰ |
| `dashboard/layout.tsx` | `enableReferralReward` | å…³é—­æ—¶ï¼šä¸è§£æ `?invite=` å‚æ•°ï¼Œä¸è§¦å‘å¥–åŠ±é€»è¾‘ |
| `api/user/profile`     | `enableReferralReward` | å…³é—­æ—¶ï¼š`referredBy` å‚æ•°è¢«å¿½ç•¥ï¼Œä¸å‘æ”¾ Pro    |
| `api/user/redeem`      | `enableRedemption`     | å…³é—­æ—¶ï¼šAPI è¿”å›"æ¿€æ´»ç åŠŸèƒ½å·²åœç”¨"             |
| `UserCenterDrawer.tsx` | `enableRedemption`     | å…³é—­æ—¶ï¼šéšè—"è¾“å…¥æ¿€æ´»ç "è¾“å…¥æ¡†                 |
| `UserCenterDrawer.tsx` | `enableReferralReward` | å…³é—­æ—¶ï¼šéšè—"é‚€è¯·å¥½å‹"å…¥å£                     |

### E. è¿è¥åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯ 1ï¼šå†…æµ‹æœŸï¼ˆå½“å‰é»˜è®¤ï¼‰
```typescript
switches: {
  requireInvite: true,
  enableReferralReward: true,
  enableRedemption: true,
}
```

#### åœºæ™¯ 2ï¼šå…¬æµ‹æœŸ
```typescript
switches: {
  requireInvite: false,  // å…³é—­é‚€è¯·å¢™
  enableReferralReward: true,
  enableRedemption: true,
}
```

#### åœºæ™¯ 3ï¼šæ­£å¼ç‰ˆï¼ˆçº¯ä»˜è´¹ï¼‰
```typescript
switches: {
  requireInvite: false,
  enableReferralReward: false,
  enableRedemption: false,
}
```

---

## âš ï¸ 6. èµ„æºç®¡æ§é€»è¾‘
1. **ç›‘æ§æ± è¿‡æœŸ**ï¼šå…è´¹ç”¨æˆ· 14 å¤©ä¸æ´»è·ƒï¼Œç§»å‡º `global_stock_pool`ï¼ŒèŠ‚çœ ETL èµ„æºã€‚
2. **AI é…é¢**ï¼šPro ç”¨æˆ·æ¯æœˆè®¾å®š AI åˆ†æä¸Šé™ï¼ˆå¦‚ 1000 æ¬¡è¯·æ±‚/æœˆï¼‰ï¼Œé˜²æ­¢ API æ»¥ç”¨ã€‚
